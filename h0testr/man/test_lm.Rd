% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/test.R
\name{test_lm}
\alias{test_lm}
\title{Hypothesis testing using the \code{stats::lm()} function}
\usage{
test_lm(state, config, fdr.method = "BY")
}
\arguments{
\item{state}{List with elements like those returned by \code{read_data()}:
\tabular{ll}{
  \code{expression} \cr \tab Numeric matrix with non-negative expression values. \cr
  \code{features}   \cr \tab A data.frame with feature meta-data for rows of expression. \cr
  \code{samples}    \cr \tab A data.frame with observation meta-data for columns of expression. \cr
}}

\item{config}{List with configuration values. Uses the following keys:
\tabular{ll}{
  \code{feat_col}       \cr \tab Name of column in \code{state$features} corresponding to \code{rownames(state$expression)}. \cr
  \code{frm}            \cr \tab Formula (formula object) to be fit \cr
  \code{test_term}      \cr \tab Term (character scalar) to be tested for non-zero coefficient. \cr
}}

\item{fdr.method}{Character scalar specifying method to use for multiple 
testing adjustment of p-values. See \code{stats::p.adjust.methods()} for 
latest list of valid choices. Currently one of:
\code{c("holm", "hochberg", "hommel", "bonferroni", "BH", "BY")}.}
}
\value{
A data.frame with results of testing. Columns include: 
    \code{c("feature", "p.adj", "pval", "Intercept")}, along with 
    coefficient estimates corresponding to \code{config$test_term}, 
    followed by corresponding feature metadata columns from 
    \code{config$features}.
}
\description{
Tests for differential expression by fitting full and reduced linear 
    models, then statistically compare them using a likelihood ratio test.
}
\details{
This test is suitable for use with missing values without imputation. The
    test does not use moderated standard error estimates, so should only be 
    relied upon when there is plenty of replication (at least 5 observations 
    per condition, preferably more).
  The \code{stats::lm()} function is used to fit the full formula specified 
    by \code{config$frm}, and also to a reduced formula derived by dropping 
    all terms (marginal and interaction terms) involving 
    \code{config$test_term}. The two models are compared using a likelihood 
    ratio test, implemented with the \code{lmtest::lrtest()} function. 
    Raw p-values are adjusted for multiple testing using 
    \code{stats::p.adjust()}.
}
\examples{
set.seed(101)
exprs <- h0testr::sim2(n_samps1=6, n_samps2=6, n_genes=25, 
  n_genes_signif=5, fold_change=2)$mat
exprs <- log2(exprs + 1)
feats <- data.frame(feature_id=rownames(exprs))
samps <- data.frame(observation_id=colnames(exprs), 
  condition=c(rep("placebo", 6), rep("drug", 6)))
state <- list(expression=exprs, features=feats, samples=samps)

config <- h0testr::new_config()    ## defaults
config$save_state <- FALSE           ## default is TRUE
config$feat_col <- config$feat_id_col <- config$gene_id_col <- "feature_id"
config$obs_col <- config$obs_id_col <- config$sample_id_col <- "observation_id"
config$frm <- ~condition
config$test_term <- "condition"
config$sample_factors <- list(condition=c("placebo", "drug"))

## set up and check covariates and parameters:
out <- h0testr::initialize(state, config, minimal=TRUE)
out$state <- h0testr::filter_features_by_formula(out$state, out$config)

tbl <- h0testr::test_lm(out$state, out$config)
print(tbl)
}
